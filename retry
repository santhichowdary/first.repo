

fortify-scan:
  stage: fortify-scan
  environment: $ENV
  image: $FMK_FORTIFY_IMAGE
  needs: 
    - job: build-jar
  variables:
    FORTIFY_SCAN_TAG: "fortify" # name of tag
    FORTIFY_SCAN_ROOT: $CI_PROJECT_DIR/target # Updated to include the target directory
    SCANCENTRAL_BUILD_OPTS: "-bt none"
    MY_VERSION: "MSTECH_HELLOWORLD_DEV"
  script:
    - echo "Begin fortify remote translation & scan"
    - export SCANCENTRAL_LOG="$CI_PROJECT_DIR"
    - export SCAN_OPTIONS="--log-file $CI_PROJECT_DIR/fortify.log --output-file $CI_PROJECT_DIR/fortify.fpr"
    - export RC=0
    - echo "$FORTIFY_SSC_URL","$FORTIFY_SSC_TOKEN","$MY_FORTIFY_SSC_APP","$MY_FORTIFY_SSC_PV","$SCANCENTRAL_BUILD_OPTS","$SCAN_OPTIONS" -application-version "$FOP_VERSION" -uptoken "$FORTIFY_SSC_TOKEN" || cat /root/.fortify/scancentral-24.4.1/log/*.log
    #- scancentral -sscurl "$FORTIFY_SSC_URL" -ssctoken $FORTIFY_SSC_TOKEN start -bt none -email $APPEMAIL -upload $CI_PROJECT_DIR/target/*.jar # Explicitly include the JAR file
    - scancentral -sscurl "$FORTIFY_SSC_URL" -ssctoken $FORTIFY_SSC_TOKEN start -sargs "$EXCLUDE_ARGS $MY_FORTIFY_SQL_PARAMETER " -targs "--build-label $MY_VERSION $EXCLUDE_ARGS $MY_FORTIFY_SQL_PARAMETER " -exclude '**/**/*.pfx' -exclude '**/**/*.jks' -exclude 'settings.xml' -upload -application "$MY_FORTIFY_SSC_APP" -version $MY_FORTIFY_SSC_PV -uptoken "$FORTIFY_SSC_TOKEN" $SCANCENTRAL_BUILD_OPTS $SCAN_OPTIONS --save-package filesscanned.zip  2> scancentral.err  || RC=$?
    - echo "result from scancentral - $RC"
    - ls -lart $CI_PROJECT_DIR
    - cat $CI_PROJECT_DIR/scancentral.err
    - if [ -f "$CI_PROJECT_DIR/scancentral.log" ]; then cat $CI_PROJECT_DIR/scancentral.log; fi
  rules:
    - if: '$CI_PIPELINE_SOURCE == "schedule" && $FORTIFY_SCAN == "true"'
    - if: '$CI_PIPELINE_SOURCE == "push" && $CI_COMMIT_REF_NAME  =~ /^main/ && $FORTIFY_SCAN == "true"'
    - if: '$CI_PIPELINE_SOURCE == "web" && $CI_COMMIT_REF_NAME  !~ /^Release.*/ && $FORTIFY_SCAN == "true"' 
    - if: '$CI_PIPELINE_SOURCE == "api" && $FORTIFY_SCAN == "true"'





    - echo "result from scancentral - $RC"
    - ls -lart $CI_PROJECT_DIR
    - cat $CI_PROJECT_DIR/scancentral.err
    - if [ -f "$CI_PROJECT_DIR/scancentral.log" ]; then cat $CI_PROJECT_DIR/scancentral.log; fi
  rules:
    - if: '$CI_PIPELINE_SOURCE == "schedule" && $FORTIFY_SCAN == "true"'
    - if: '$CI_PIPELINE_SOURCE == "push" && $CI_COMMIT_REF_NAME  =~ /^main/ && $FORTIFY_SCAN == "true"'
    - if: '$CI_PIPELINE_SOURCE == "web" && $CI_COMMIT_REF_NAME  !~ /^Release.*/ && $FORTIFY_SCAN == "true"' 
    - if: '$CI_PIPELINE_SOURCE == "api" && $FORTIFY_SCAN == "true"'





my repo 

spec:
  inputs:
    JOBNAME:
      default: run_fortify_scan_service
      description: 'REQUIRED: Job name for Fortify Scan Service'
    STAGE:
      default: fortify_scan
      description: 'REQUIRED: Stage name for this job'
    IMAGE:
      default: $FORTIFY_IMG
      description: 'REQUIRED: Docker image to use for Fortify Scan Service'
    APPLICATION_NAME:
      default: $MY_FORTIFY_SSC_APP
      description: 'REQUIRED: Fortify SSC Application Name'
    VERSION_NAME:
      default: $MY_FORTIFY_SSC_PV
      description: 'REQUIRED: Fortify SSC Version Name'
    FORTIFY_SSC_URL:
      default: $FORTIFY_SSC_URL
      description: 'REQUIRED: Fortify SSC URL'
    FORTIFY_SSC_TOKEN:
      default: $FORTIFY_SSC_TOKEN
      description: 'REQUIRED: Fortify SSC Token'
    SCAN_OPTIONS:
      default: "--log-file $CI_PROJECT_DIR/fortify.log --output-file $CI_PROJECT_DIR/fortify.fpr"
      description: 'Optional: Additional scan options'

---      

"$[[ inputs.JOBNAME ]]":
  stage: $[[ inputs.STAGE ]]
  image: $[[ inputs.IMAGE ]]
  environment: $ENV
  script:
    - echo "Starting Fortify scan for service"
    - export SCANCENTRAL_LOG="$CI_PROJECT_DIR"
    - export RC=0
    - cd $CI_PROJECT_DIR/servicefolder  # Change to service folder
    - scancentral -sscurl "$[[ inputs.FORTIFY_SSC_URL ]]" -ssctoken $[[ inputs.FORTIFY_SSC_TOKEN ]] start -sargs "$EXCLUDE_ARGS $MY_FORTIFY_SQL_PARAMETER" -targs "--build-label $[[ inputs.VERSION_NAME ]] $EXCLUDE_ARGS $MY_FORTIFY_SQL_PARAMETER" -exclude '**/**/*.pfx' -exclude '**/**/*.jks' -exclude 'settings.xml' -upload -application "$[[ inputs.APPLICATION_NAME ]]" -version $[[ inputs.VERSION_NAME ]] -uptoken "$[[ inputs.FORTIFY_SSC_TOKEN ]]" $SCANCENTRAL_BUILD_OPTS $[[ inputs.SCAN_OPTIONS ]] --save-package filesscanned.zip 2> scancentral.err || RC=$?
    - echo "Result from Fortify scan service - $RC"
    - ls -lart $CI_PROJECT_DIR  # List project directory to debug
    - if [ -f "$CI_PROJECT_DIR/scancentral.log" ]; then cat $CI_PROJECT_DIR/scancentral.log; fi  # Display logs if exists
  rules:
    - if: '$CI_PIPELINE_SOURCE == "schedule" && $FORTIFY_SCAN == "true"'
    - if: '$CI_PIPELINE_SOURCE == "push" && $CI_COMMIT_REF_NAME =~ /^main/ && $FORTIFY_SCAN == "true"'
    - if: '$CI_PIPELINE_SOURCE == "web" && $CI_COMMIT_REF_NAME !~ /^Release.*/ && $FORTIFY_SCAN == "true"'
    - if: '$CI_PIPELINE_SOURCE == "api" && $FORTIFY_SCAN == "true"'




---

"$[[ inputs.JOBNAME ]]":
  stage: $[[ inputs.STAGE ]]
  image: $[[ inputs.IMAGE ]]
  environment: $ENV
  script:
    - echo "Starting Fortify scan for UI"
    - export SCANCENTRAL_LOG="$CI_PROJECT_DIR"
    - export RC=0
    - cd $CI_PROJECT_DIR/uifolder  # Change to UI folder
    - scancentral -sscurl "$[[ inputs.FORTIFY_SSC_URL ]]" -ssctoken $[[ inputs.FORTIFY_SSC_TOKEN ]] start -sargs "$EXCLUDE_ARGS $MY_FORTIFY_SQL_PARAMETER" -targs "--build-label $[[ inputs.VERSION_NAME ]] $EXCLUDE_ARGS $MY_FORTIFY_SQL_PARAMETER" -exclude '**/**/*.pfx' -exclude '**/**/*.jks' -exclude 'settings.xml' -upload -application "$[[ inputs.APPLICATION_NAME ]]" -version $[[ inputs.VERSION_NAME ]] -uptoken "$[[ inputs.FORTIFY_SSC_TOKEN ]]" $SCANCENTRAL_BUILD_OPTS $[[ inputs.SCAN_OPTIONS ]] --save-package filesscanned.zip 2> scancentral.err || RC=$?
    - echo "Result from Fortify scan UI - $RC"
    - ls -lart $CI_PROJECT_DIR  # List project directory to debug
    - if [ -f "$CI_PROJECT_DIR/scancentral.log" ]; then cat $CI_PROJECT_DIR/scancentral.log; fi  # Display logs if exists
  rules:
    - if: '$CI_PIPELINE_SOURCE == "schedule" && $FORTIFY_SCAN == "true"'
    - if: '$CI_PIPELINE_SOURCE == "push" && $CI_COMMIT_REF_NAME =~ /^main/ && $FORTIFY_SCAN == "true"'
    - if: '$CI_PIPELINE_SOURCE == "web" && $CI_COMMIT_REF_NAME !~ /^Release.*/ && $FORTIFY_SCAN == "true"'
    - if: '$CI_PIPELINE_SOURCE == "api" && $FORTIFY_SCAN == "true"'
    
    - when: manual



reference---------------

#
# fortify-scan.yml
#
fortify-scan-service:
  stage: fortify-scan
  environment: $ENV
  #image: nexus.onefiserv.net:8082/guhsdo-u-docker-hosted/appsec/fortify-21.2.3:latest
  image: $FORTIFY_IMG
  variables:
    FORTIFY_SCAN_TAG: "fortify" # name of tag
    #FORTIFY_SCAN_ROOT: $CI_PROJECT_DIR/sales-regime        # folder to use as root folder for upload
    FORTIFY_SCAN_ROOT: $CI_PROJECT_DIR # folder to use as root folder for upload
    #BUILDID: "Catalyst"
    SCANCENTRAL_BUILD_OPTS: "-bt none"
    #SCANCENTRAL_BUILD_OPTS: "-b Catalyst"
    # FORTIFY_SSC_URL and FORTIFY_SSC_TOKEN are expected as GitLab CI/CD Variables (masking recommended)
    #FORTIFY_SSC_TOKEN: <to be defined>                     # CI token type generated in https://fortify.1dc.com/ssc/html/ssc/admin/tokens
    #FORTIFY_SSC_URL: "https://fortify.1dc.com/ssc"
    #
    # ---  fill these variables in app specific variables
    #
    #MY_VERSION: "$CI_COMMIT_SHORT_SHA"                     # suggestion: use UNIQUE_VERSION commit hash
    MY_VERSION: "$CI_PIPELINE_IID"
    #MY_FORTIFY_SSC_APP: "UAID-11219" # unique for the application
    #MY_FORTIFY_SSC_PV: "1.0"
    #
  script:
    - echo "Begin fortify remote translation & scan"
    - export SCANCENTRAL_LOG="$CI_PROJECT_DIR"
    - export SCAN_OPTIONS="--log-file $CI_PROJECT_DIR/fortify.log --output-file $CI_PROJECT_DIR/fortify.fpr"
    - export RC=0
    - cd $CI_PROJECT_DIR/dataimportmaintenanceservice
  #  - scancentral arguments -o -targs "--build-label $MY_VERSION $EXCLUDE_ARGS $MY_FORTIFY_SQL_PARAMETER -exclude '**/**/*.jks'" -exclude '**/**/*.pfx' -sargs "$EXCLUDE_ARGS $MY_FORTIFY_SQL_PARAMETER -exclude '**/**/*.jks'" 
    - echo "$FORTIFY_SSC_URL","$FORTIFY_SSC_TOKEN","$MY_FORTIFY_SSC_APP","$MY_FORTIFY_SSC_PV","$SCANCENTRAL_BUILD_OPTS","$SCAN_OPTIONS"
    - scancentral -sscurl "$FORTIFY_SSC_URL" -ssctoken $FORTIFY_SSC_TOKEN start -sargs "$EXCLUDE_ARGS $MY_FORTIFY_SQL_PARAMETER " -targs "--build-label $MY_VERSION $EXCLUDE_ARGS $MY_FORTIFY_SQL_PARAMETER " -exclude '**/**/*.pfx' -exclude '**/**/*.jks' -exclude 'settings.xml' -upload -application "$MY_FORTIFY_SSC_APP" -version $MY_FORTIFY_SSC_PV -uptoken "$FORTIFY_SSC_TOKEN" $SCANCENTRAL_BUILD_OPTS $SCAN_OPTIONS --save-package filesscanned.zip  2> scancentral.err  || RC=$?
    - echo "result from scancentral - $RC"
    - ls -lart $CI_PROJECT_DIR
    - if [ -f "$CI_PROJECT_DIR/scancentral.log" ]; then cat $CI_PROJECT_DIR/scancentral.log; fi
  rules:
    - if: '$CI_PIPELINE_SOURCE == "schedule" && $FORTIFY_SCAN == "true"'
    - if: '$CI_PIPELINE_SOURCE == "push" && $CI_COMMIT_REF_NAME  =~ /^main/ && $FORTIFY_SCAN == "true"'
    - if: '$CI_PIPELINE_SOURCE == "web" && $CI_COMMIT_REF_NAME  !~ /^Release.*/ && $FORTIFY_SCAN == "true"' 
    - if: '$CI_PIPELINE_SOURCE == "api" && $FORTIFY_SCAN == "true"'

fortify-scan-ui:
  stage: fortify-scan
  environment: $ENV
  #image: nexus.onefiserv.net:8082/guhsdo-u-docker-hosted/appsec/fortify-21.2.3:latest
  image: $FORTIFY_IMG
  variables:
    FORTIFY_SCAN_TAG: "fortify" # name of tag
    #FORTIFY_SCAN_ROOT: $CI_PROJECT_DIR/sales-regime        # folder to use as root folder for upload
    FORTIFY_SCAN_ROOT: $CI_PROJECT_DIR # folder to use as root folder for upload
    #BUILDID: "Catalyst"
    SCANCENTRAL_BUILD_OPTS: "-bt none"
    #SCANCENTRAL_BUILD_OPTS: "-b Catalyst"
    # FORTIFY_SSC_URL and FORTIFY_SSC_TOKEN are expected as GitLab CI/CD Variables (masking recommended)
    #FORTIFY_SSC_TOKEN: <to be defined>                     # CI token type generated in https://fortify.1dc.com/ssc/html/ssc/admin/tokens
    #FORTIFY_SSC_URL: "https://fortify.1dc.com/ssc"
    #
    # ---  fill these variables in app specific variables
    #
    #MY_VERSION: "$CI_COMMIT_SHORT_SHA"                     # suggestion: use UNIQUE_VERSION commit hash
    MY_VERSION: "$CI_PIPELINE_IID"
    #MY_FORTIFY_SSC_APP: "UAID-11219" # unique for the application
    #MY_FORTIFY_SSC_PV: "1.0"
    #
  script:
    - echo "Begin fortify remote translation & scan"
    - export SCANCENTRAL_LOG="$CI_PROJECT_DIR"
    - export SCAN_OPTIONS="--log-file $CI_PROJECT_DIR/fortify.log --output-file $CI_PROJECT_DIR/fortify.fpr"
    - export RC=0
    - cd $CI_PROJECT_DIR/dataimportmaintenanceui
  #  - scancentral arguments -o -targs "--build-label $MY_VERSION $EXCLUDE_ARGS $MY_FORTIFY_SQL_PARAMETER -exclude '**/**/*.jks'" -exclude '**/**/*.pfx' -sargs "$EXCLUDE_ARGS $MY_FORTIFY_SQL_PARAMETER -exclude '**/**/*.jks'" 
    - echo "$FORTIFY_SSC_URL","$FORTIFY_SSC_TOKEN","$MY_FORTIFY_SSC_APP","$MY_FORTIFY_SSC_PV1","$SCANCENTRAL_BUILD_OPTS","$SCAN_OPTIONS"
    - scancentral -sscurl "$FORTIFY_SSC_URL" -ssctoken $FORTIFY_SSC_TOKEN start -sargs "$EXCLUDE_ARGS $MY_FORTIFY_SQL_PARAMETER " -targs "--build-label $MY_VERSION $EXCLUDE_ARGS $MY_FORTIFY_SQL_PARAMETER " -exclude 'settings.xml' -upload -application "$MY_FORTIFY_SSC_APP" -version $MY_FORTIFY_SSC_PV1 -uptoken "$FORTIFY_SSC_TOKEN" $SCANCENTRAL_BUILD_OPTS $SCAN_OPTIONS --save-package filesscanned.zip  2> scancentral.err  || RC=$?
    - echo "result from scancentral - $RC"
    - ls -lart $CI_PROJECT_DIR
    - if [ -f "$CI_PROJECT_DIR/scancentral.log" ]; then cat $CI_PROJECT_DIR/scancentral.log; fi
  rules:
    - if: '$CI_PIPELINE_SOURCE == "schedule" && $FORTIFY_SCAN == "true"'
    - if: '$CI_PIPELINE_SOURCE == "push" && $CI_COMMIT_REF_NAME  =~ /^main/ && $FORTIFY_SCAN == "true"'
    - if: '$CI_PIPELINE_SOURCE == "web" && $CI_COMMIT_REF_NAME  !~ /^Release.*/ && $FORTIFY_SCAN == "true"' 
    - if: '$CI_PIPELINE_SOURCE == "api" && $FORTIFY_SCAN == "true"'










sent------------------------------------------------


# ci/components/fortify_scan_job.yml
spec:
  inputs:
    JOBNAME:
      default: run_fortify_scan
      description: 'REQUIRED: Job name for Fortify Scan'
    STAGE:
      default: fortify_scan
      description: 'REQUIRED: Stage name for this job'
    IMAGE:
      default: $FORTIFY_IMG
      description: 'REQUIRED: Docker image to use for Fortify Scan'
    APPLICATION_NAME:
      default: $MY_FORTIFY_SSC_APP
      description: 'REQUIRED: Fortify SSC Application Name'
    VERSION_NAME:
      default: $MY_FORTIFY_SSC_PV
      description: 'REQUIRED: Fortify SSC Version Name'
    FORTIFY_SSC_URL:
      default: $FORTIFY_SSC_URL
      description: 'REQUIRED: Fortify SSC URL'
    FORTIFY_SSC_TOKEN:
      default: $FORTIFY_SSC_TOKEN
      description: 'REQUIRED: Fortify SSC Token'
    SCAN_OPTIONS:
      default: "--log-file $CI_PROJECT_DIR/fortify.log --output-file $CI_PROJECT_DIR/fortify.fpr"
      description: 'Optional: Additional scan options'
    SCAN_TARGET:
      default: service
      description: 'REQUIRED: Specify the target to scan, either "service" or "ui"'

---

"$[[ inputs.JOBNAME ]]":
  stage: $[[ inputs.STAGE ]]
  image: $[[ inputs.IMAGE ]]
  environment: $ENV
  needs:
    - job: build-jar  # This ensures the scan runs after the build job
  script:
    - echo "Starting Fortify scan for $[[ inputs.SCAN_TARGET ]]"
    - export SCANCENTRAL_LOG="$CI_PROJECT_DIR"
    - export RC=0
    - |
      if [ "$[[ inputs.SCAN_TARGET ]]" == "service" ]; then
        cd $CI_PROJECT_DIR/servicefolder  # Change to service folder
      elif [ "$[[ inputs.SCAN_TARGET ]]" == "ui" ]; then
        cd $CI_PROJECT_DIR/uifolder  # Change to UI folder
      else
        echo "Unknown scan target: $[[ inputs.SCAN_TARGET ]]"
        exit 1
      fi
    - scancentral -sscurl "$[[ inputs.FORTIFY_SSC_URL ]]" -ssctoken $[[ inputs.FORTIFY_SSC_TOKEN ]] start -sargs "$EXCLUDE_ARGS $MY_FORTIFY_SQL_PARAMETER" -targs "--build-label $[[ inputs.VERSION_NAME ]] $EXCLUDE_ARGS $MY_FORTIFY_SQL_PARAMETER" -exclude '**/**/*.pfx' -exclude '**/**/*.jks' -exclude 'settings.xml' -upload -application "$[[ inputs.APPLICATION_NAME ]]" -version $[[ inputs.VERSION_NAME ]] -uptoken "$[[ inputs.FORTIFY_SSC_TOKEN ]]" $SCANCENTRAL_BUILD_OPTS $[[ inputs.SCAN_OPTIONS ]] --save-package filesscanned.zip 2> scancentral.err || RC=$?
    - echo "Result from Fortify scan - $RC"
    - ls -lart $CI_PROJECT_DIR  # List project directory to debug
    - if [ -f "$CI_PROJECT_DIR/scancentral.log" ]; then cat $CI_PROJECT_DIR/scancentral.log; fi  # Display logs if exists
  rules:
    - if: '$CI_PIPELINE_SOURCE == "schedule" && $FORTIFY_SCAN == "true"'
    - if: '$CI_PIPELINE_SOURCE == "push" && $CI_COMMIT_REF_NAME =~ /^main/ && $FORTIFY_SCAN == "true"'
    - if: '$CI_PIPELINE_SOURCE == "web" && $CI_COMMIT_REF_NAME !~ /^Release.*/ && $FORTIFY_SCAN == "true"'
    - if: '$CI_PIPELINE_SOURCE == "api" && $FORTIFY_SCAN == "true"'




errro----

spec:
  inputs:
    JOBNAME:
      default: run_fortify_scan
      description: 'REQUIRED: Job name for Fortify Scan'
    STAGE:
      default: fortify_scan
      description: 'REQUIRED: Stage name for this job'
    IMAGE:
      default: $FORTIFY_IMG
      description: 'REQUIRED: Docker image to use for Fortify Scan'
    APPLICATION_NAME:
      default: $MY_FORTIFY_SSC_APP
      description: 'REQUIRED: Fortify SSC Application Name'
    VERSION_NAME:
      default: $MY_FORTIFY_SSC_PV
      description: 'REQUIRED: Fortify SSC Version Name'
    FORTIFY_SSC_URL:
      default: $FORTIFY_SSC_URL
      description: 'REQUIRED: Fortify SSC URL'
    FORTIFY_SSC_TOKEN:
      default: $FORTIFY_SSC_TOKEN
      description: 'REQUIRED: Fortify SSC Token'
    SCAN_OPTIONS:
      default: "--log-file $CI_PROJECT_DIR/fortify.log --output-file $CI_PROJECT_DIR/fortify.fpr"
      description: 'Optional: Additional scan options'
    SCAN_TARGET:
      default: "target"
      description: 'REQUIRED: Specify the target to scan, either "service" or "ui" or any target directory'

---

"$[[ inputs.JOBNAME ]]":
  stage: $[[ inputs.STAGE ]]
  image: $[[ inputs.IMAGE ]]
  environment: $ENV
  needs:
    - job: build-jar  # This ensures the scan runs after the build job
  script:
    - echo "Starting Fortify scan for $[[ inputs.SCAN_TARGET ]]"
    - export SCANCENTRAL_LOG="$CI_PROJECT_DIR"
    - export RC=0
    - |
      if [ "$[[ inputs.SCAN_TARGET ]]" == "service" ]; then
        cd $CI_PROJECT_DIR/servicefolder  # Change to service folder
      elif [ "$[[ inputs.SCAN_TARGET ]]" == "ui" ]; then
        cd $CI_PROJECT_DIR/uifolder  # Change to UI folder
      elif ["$[[ inputs.SCAN_TARGET ]]" == "target" ]; then
        cd $CI_PROJECT_DIR/target 
      else
        echo "Unknown scan target: $[[ inputs.SCAN_TARGET ]]"
        exit 1
      fi
    - scancentral -sscurl "$[[ inputs.FORTIFY_SSC_URL ]]" -ssctoken $[[ inputs.FORTIFY_SSC_TOKEN ]] start -sargs "$EXCLUDE_ARGS $MY_FORTIFY_SQL_PARAMETER" -targs "--build-label $[[ inputs.VERSION_NAME ]] $EXCLUDE_ARGS $MY_FORTIFY_SQL_PARAMETER" -exclude '**/**/*.pfx' -exclude '**/**/*.jks' -exclude 'settings.xml' -upload -application "$[[ inputs.APPLICATION_NAME ]]" -version $[[ inputs.VERSION_NAME ]] -uptoken "$[[ inputs.FORTIFY_SSC_TOKEN ]]" $SCANCENTRAL_BUILD_OPTS $[[ inputs.SCAN_OPTIONS ]] --save-package filesscanned.zip 2> scancentral.err || RC=$?
    - echo "Result from Fortify scan - $RC"
    - ls -lart $CI_PROJECT_DIR  # List project directory to debug
    - if [ -f "$CI_PROJECT_DIR/scancentral.log" ]; then cat $CI_PROJECT_DIR/scancentral.log; fi  # Display logs if exists
  rules:
    - if: '$CI_PIPELINE_SOURCE == "schedule" && $FORTIFY_SCAN == "true"'
    - if: '$CI_PIPELINE_SOURCE == "push" && $CI_COMMIT_REF_NAME =~ /^main/ && $FORTIFY_SCAN == "true"'
    - if: '$CI_PIPELINE_SOURCE == "web" && $CI_COMMIT_REF_NAME !~ /^Release.*/ && $FORTIFY_SCAN == "true"'
    - if: '$CI_PIPELINE_SOURCE == "api" && $FORTIFY_SCAN == "true"'












Created fresh repository.
Checking out 02c7887e as detached HEAD (ref is cicd-scan-files)...
Skipping Git submodules setup
Downloading artifacts
00:01
Downloading artifacts for build-jar (14226896)...
Downloading artifacts from coordinator... ok        host=gitlab.onefiserv.net id=14226896 responseStatus=200 OK token=glcbt-64
Executing "step_script" stage of the job script
00:01
$ echo "Starting Fortify scan for service"
Starting Fortify scan for service
$ export SCANCENTRAL_LOG="$CI_PROJECT_DIR"
$ export RC=0
$ if [ "service" == "service" ]; then # collapsed multi-line command
/scripts-49649-14227288/step_script: line 229: cd: /builds/mstechpe/shared-apps/java17_template_port9000/servicefolder: No such file or directory
Cleaning up project directory and file based variables
00:00
ERROR: Job failed: command terminated with exit code 1




- |
  if [ "$[[ inputs.SCAN_TARGET ]]" == "service" ]; then
    if [ -d "$CI_PROJECT_DIR/servicefolder" ]; then
      echo "Switching to service folder"
      cd "$CI_PROJECT_DIR/servicefolder"
    else
      echo "Warning: servicefolder not found, staying in root"
    fi
  elif [ "$[[ inputs.SCAN_TARGET ]]" == "ui" ]; then
    if [ -d "$CI_PROJECT_DIR/uifolder" ]; then
      echo "Switching to ui folder"
      cd "$CI_PROJECT_DIR/uifolder"
    else
      echo "Warning: uifolder not found, staying in root"
    fi
  elif [ "$[[ inputs.SCAN_TARGET ]]" == "target" ]; then
    if [ -d "$CI_PROJECT_DIR/target" ]; then
      echo "Switching to target folder"
      cd "$CI_PROJECT_DIR/target"
    else
      echo "Warning: target folder not found, staying in root"
    fi
  else
    echo "Unknown scan target: $[[ inputs.SCAN_TARGET ]]"
    exit 1
  fi










ci yaml file 


# Define the stages of the pipeline
# CI
stages:
  - build-jar
  #- build-jar-ui
  #- build_breaker_scan
  - fortify_scan
  #- build-jar
  # Add other stages as needed

 #Set global variables for the pipeline
variables:
  BUILD_BREAKER: "true" 
  FORTIFY_SCAN : "true" 
  SCANCENTRAL_BUILD_OPTS: "-bt none"
  SOURCE_NEXUS_REGISTRY: "fmk.nexus.onefiserv.net"
  FMK_FORTIFY_IMAGE: "$SOURCE_NEXUS_REGISTRY/vendor/docker/fortifydocker/fortify-ci-tools:6.2.0-jdk-17"
  IMAGE_TAGS: "latest"
  FORTIFY_SSC_TOKEN: "YzlkZGVjMjgtZThhYS00OTRiLTk4ZjEtMWM4NmYxY2JkYjFj"
  FORTIFY_SSC_URL: "https://fortify.fiserv.one/ssc"
  FORTIFY_SSC_APP: "APM0011432"
  FOP_VERSION:  "MSTECH_HELLOWORLD_DEV"
  APPEMAIL: santhisri.kankanala@fiserv.com

  #ENV: "test"             # Set the environment (e.g., dev, qa, prod)
  #FORTIFY_IMG: "fmk.nexus.onefiserv.net/fmk/ext-tools/fortify-22-2-0:FMK-02-23-23"  # Docker image for Fortify
  #MY_FORTIFY_SSC_APP: "my-sample-app"  # Application name for Fortify
  #MY_FORTIFY_SSC_PV: "1.0.0"          # Application version for Fortify
  #BUILD_BREAKER_PACKAGE_URL: "https://example.com/buildbreaker.tar"  # URL to the build breaker package

# Include the build-breaker-scan component
include:
  #- component: "$CI_SERVER_FQDN/mstechpe/shared-apps/cicd-components/build_breaker_scan@cicd-scan-files"
  #  inputs:
  #    JOBNAME: build_breaker_scan
  #    STAGE: build_breaker_scan

  - component: $CI_SERVER_FQDN/mstechpe/shared-apps/cicd-components/build@0.0.1
    inputs:
      JOBNAME: build-jar
      STAGE: build-jar
      TARGET_PLATFORM: AWS_ECS
      IMAGE: $JAVA_IMG
      #NEEDS: []
      #DEPENDENCIES: []
      ARTIFACT_FOLDER: [$CI_PROJECT_DIR/target/*]

#  - component: $CI_SERVER_FQDN/mstechpe/shared-apps/cicd-components/build-upload@0.0.1
#    inputs:
#      JOBNAME: build-docker-image
#      STAGE: build-docker-image
#      TARGET_PLATFORM: AWS_ECS
#      IMAGE: $DOCKER_DIND_BASE
#      #PACKAGES: (target/first target/second target/third)
#      NEEDS: [job: build-jar]
#      DEPENDENCIES: [build-jar]
#      ARTIFACT_FOLDER: [$CI_PROJECT_DIR/*] 
    


  - component: "$CI_SERVER_FQDN/mstechpe/shared-apps/cicd-components/fortify-scan@cicd-scan-files"
    inputs:
      JOBNAME: fortify-scan
      STAGE: fortify_scan    
      NEEDS: [build-jar]
      #ENV: "dev"
      #IMAGE: $FORTIFY_IMG
      #MY_FORTIFY_SSC_APP: $MY_FORTIFY_SSC_APP
      #MY_FORTIFY_SSC_PV: $MY_FORTIFY_SSC_PV
      #BUILD_BREAKER_PACKAGE_URL: $BUILD_BREAKER_PACKAGE_URL
